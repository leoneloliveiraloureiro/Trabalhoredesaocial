<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Simulador de Hashing - Vida Digital</title>
  <style>
    :root { --bg: #f2f2f2; --card: #ffffff; --muted: #666; }
    body {
      font-family: Inter, Arial, sans-serif;
      background: var(--bg);
      color: #0b84ff;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
    }
    .header { display: flex; align-items: center; justify-content: center; gap: 14px; }
    .header img { width: 60px; height: 60px; object-fit: contain; }
    .header h1 { font-size: 2rem; margin: 0; color: #0b84ff; }
    .main-content {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;
      width: 100%; max-width: 1500px;
    }
    .container {
      background: var(--card); padding: 18px; border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06); width: 500px; box-sizing: border-box;
    }
    h2, h3 { margin: 6px 0; }
    label { font-size: 13px; color: var(--muted); }
    input, button {
      width: 100%; padding: 10px 12px; margin-top: 8px; margin-bottom: 6px;
      border-radius: 8px; border: 1px solid #e6e6e6; font-size: 14px;
    }
    button { cursor: pointer; border: none; background: #0b84ff; color: white; font-weight: 600; }
    #hashResult { background: #fafafa; padding: 10px; border-radius: 8px; word-wrap: break-word; display: none; }
    #bancoDados { background: #fbfbff; padding: 10px; border-radius: 8px; font-size: 13px; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 6px; border-bottom: 1px solid #f0f0f0; text-align: left; word-break: break-word; }
    .muted { color: #888; font-size: 12px; }
    .success { color: green; }
    .error { color: red; }
    @media (max-width: 1000px) { .main-content { flex-direction: column; align-items: center; } }
  </style>
</head>
<body>

  <!-- Cabe√ßalho -->
  <div class="header">
    <img src="TESTE.png" alt="Logo Vida Digital">
    <h1>Vida Digital</h1>
  </div>

  <!-- Containers -->
  <div class="main-content">
    <div class="container">
      <h2>Criar Conta</h2>
      <label for="usuario">Nome de usu√°rio</label>
      <input type="text" id="usuario" placeholder="Ex: joao">
      <label for="senha">Senha</label>
      <input type="password" id="senha" placeholder="Sua senha (n√£o ser√° armazenada)">
      <button id="btnCriar">Gerar Hash e Salvar</button>
      <div id="hashResult" aria-live="polite"></div>
      <p class="small">
        Ao criar, apenas o <strong>hash</strong> da senha √© salvo no banco ‚Äî a senha em texto puro nunca √© armazenada.
      </p>
    </div>

    <div class="container">
      <h2>Login</h2>
      <label for="loginUser">Usu√°rio</label>
      <input type="text" id="loginUser" placeholder="Digite seu usu√°rio">
      <label for="loginPass">Senha</label>
      <input type="password" id="loginPass" placeholder="Digite a senha para verificar">
      <button id="btnLogin">Tentar Login</button>
      <div id="loginMsg" class="muted"></div>
    </div>

    <div class="container">
      <h3>Banco de Dados (Firestore)</h3>
      <div id="bancoDados"><em>Carregando...</em></div>
    </div>
  </div>

  <!-- L√≥gica principal -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // üî• Cole sua configura√ß√£o Firebase aqui:
    const firebaseConfig = {
      apiKey: "AIzaSyCqtIahDDW_Dw5NYZ9AK524VbkxNg7vvhI",
      authDomain: "seuprojeto.firebaseapp.com",
      projectId: "kubo-aafcc",
      storageBucket: "seuprojeto.appspot.com",
      messagingSenderId: "968436349335",
      appId: "1:000000000:web:abc123"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colUsuarios = collection(db, "usuarios");

    // Utilit√°rios
    async function sha256Hex(str) {
      const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,"0")).join("");
    }

    function escapeHtml(t) {
      return t.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    async function renderBanco() {
      const cont = document.getElementById("bancoDados");
      const snap = await getDocs(colUsuarios);
      if (snap.empty) {
        cont.innerHTML = "<em>Nenhum usu√°rio salvo ainda.</em>";
        return;
      }
      let html = "<table><thead><tr><th>Usu√°rio</th><th>Hash</th></tr></thead><tbody>";
      snap.forEach(doc => {
        const { usuario, hash } = doc.data();
        html += `<tr><td>${escapeHtml(usuario)}</td><td><code>${hash}</code></td></tr>`;
      });
      cont.innerHTML = html + "</tbody></table>";
    }

    // Criar usu√°rio
    document.getElementById("btnCriar").addEventListener("click", async () => {
      const u = document.getElementById("usuario").value.trim();
      const s = document.getElementById("senha").value;
      const resDiv = document.getElementById("hashResult");
      resDiv.style.display = "none";

      if (!u || !s) {
        resDiv.style.display = "block";
        resDiv.textContent = "Preencha usu√°rio e senha.";
        resDiv.className = "error";
        return;
      }

      // Verifica duplicado
      const snap = await getDocs(query(colUsuarios, where("usuario", "==", u)));
      if (!snap.empty) {
        resDiv.style.display = "block";
        resDiv.textContent = "Nome de usu√°rio j√° existe.";
        resDiv.className = "error";
        return;
      }

      const hash = await sha256Hex(s);
      await addDoc(colUsuarios, { usuario: u, hash });
      resDiv.style.display = "block";
      resDiv.className = "";
      resDiv.innerHTML = `<strong>Hash gerado (SHA-256):</strong><br><code>${hash}</code>`;
      document.getElementById("senha").value = "";
      renderBanco();
    });

    // Login
    document.getElementById("btnLogin").addEventListener("click", async () => {
      const u = document.getElementById("loginUser").value.trim();
      const s = document.getElementById("loginPass").value;
      const msg = document.getElementById("loginMsg");
      msg.textContent = "";

      if (!u || !s) { msg.textContent = "Preencha usu√°rio e senha."; return; }

      const snap = await getDocs(query(colUsuarios, where("usuario", "==", u)));
      if (snap.empty) { msg.textContent = "Usu√°rio n√£o encontrado."; return; }

      const docData = snap.docs[0].data();
      const tentativaHash = await sha256Hex(s);
      msg.innerHTML = (tentativaHash === docData.hash)
        ? '<span class="success">Login aprovado ‚Äî hashes coincidem.</span>'
        : '<span class="error">Senha incorreta ‚Äî hash n√£o confere.</span>';

      document.getElementById("loginPass").value = "";
    });

    renderBanco();
  </script>
</body>
</html>

