<!DOCTYPE html><html lang="pt-BR">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Simulador de Hashing - Vida Digital</title>
    <style>
        :root{--bg:#f2f2f2;--card:#ffffff;--muted:#666}
        body {
            font-family: Inter, Arial, sans-serif;
            background: var(--bg);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 20px;
            gap:20px;
        }
        .container {
            background: var(--card);
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.06);
            width: 460px;
        }
        h2,h3{margin:6px 0}
        label{font-size:13px;color:var(--muted)}
        input, button, textarea {
            width: 100%;
            padding: 10px 12px;
            margin-top: 8px;
            margin-bottom: 6px;
            border-radius: 8px;
            border: 1px solid #e6e6e6;
            box-sizing: border-box;
            font-size:14px;
        }
        .small{font-size:13px;color:var(--muted);}
        .row{display:flex;gap:10px}
        .row > *{flex:1}
        button{cursor:pointer;border:none;background:#0b84ff;color:white}
        #hashResult{background:#fafafa;padding:10px;border-radius:8px;word-wrap:break-word;display:none}
        #bancoDados{background:#fbfbff;padding:10px;border-radius:8px;font-size:13px}
        table{width:100%;border-collapse:collapse;font-size:13px}
        th,td{padding:6px;border-bottom:1px solid #f0f0f0;text-align:left;word-break:break-word}
        .muted{color:#888;font-size:12px}
        .success{color:green}
        .error{color:red}
    </style>
</head>
<body>
    <div class="container">
        <h2>Criar Conta — Vida Digital </h2>
        <label for="usuario">Nome de usuário</label>
        <input type="text" id="usuario" placeholder="Ex: joao">
        <label for="senha">Senha</label>
        <input type="password" id="senha" placeholder="Sua senha (não será armazenada)">
        <button id="btnCriar">Gerar Hash e Salvar</button>
        <div id="hashResult" aria-live="polite"></div>
        <p class="small">Ao criar, apenas o <strong>hash</strong> da senha é salvo no banco simulado — a senha em texto puro nunca é armazenada.</p>
    </div><div class="container">
    <h2>Login</h2>
    <label for="loginUser">Usuário</label>
    <input type="text" id="loginUser" placeholder="Digite seu usuário">
    <label for="loginPass">Senha</label>
    <input type="password" id="loginPass" placeholder="Digite a senha para verificar">
    <button id="btnLogin">Tentar Login</button>
    <div id="loginMsg" class="muted"></div>
</div>

<div class="container">
    <h3>Banco de Dados (Simulado)</h3>
    <div id="bancoDados"><em>Nenhum usuário salvo ainda.</em></div>
</div>

<script>
    // Simulação de um banco de dados na memória (array de objetos)
    const db = []; // cada entrada: { usuario: string, hash: string }

    // Utilitários
    async function sha256Hex(str){
        const enc = new TextEncoder();
        const data = enc.encode(str);
        const buf = await crypto.subtle.digest('SHA-256', data);
        const arr = Array.from(new Uint8Array(buf));
        return arr.map(b => b.toString(16).padStart(2,'0')).join('');
    }

    function renderBanco(){
        const cont = document.getElementById('bancoDados');
        if(db.length === 0){
            cont.innerHTML = '<em>Nenhum usuário salvo ainda.</em>';
            return;
        }
        let html = '<table><thead><tr><th>Usuário</th><th>Hash (armazenado)</th></tr></thead><tbody>';
        for(const row of db){
            html += `<tr><td>${escapeHtml(row.usuario)}</td><td><code title="hash">${row.hash}</code></td></tr>`;
        }
        html += '</tbody></table>';
        cont.innerHTML = html;
    }

    function escapeHtml(text){
        return text.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]));
    }

    // Criar conta
    document.getElementById('btnCriar').addEventListener('click', async ()=>{
        const u = document.getElementById('usuario').value.trim();
        const s = document.getElementById('senha').value;
        const resDiv = document.getElementById('hashResult');
        resDiv.style.display = 'none';
        if(!u || !s){
            resDiv.style.display = 'block';
            resDiv.textContent = 'Preencha usuário e senha.';
            resDiv.className = 'error';
            return;
        }

        // Verifica se usuário já existe
        if(db.some(x => x.usuario.toLowerCase() === u.toLowerCase())){
            resDiv.style.display = 'block';
            resDiv.textContent = 'Nome de usuário já existe. Escolha outro.';
            resDiv.className = 'error';
            return;
        }

        const hash = await sha256Hex(s);

        // Salva no 'BD' (apenas usuário + hash)
        db.push({usuario: u, hash});

        // Mostra o hash gerado para o visitante (visualização didática)
        resDiv.style.display = 'block';
        resDiv.className = '';
        resDiv.innerHTML = `<strong>Hash gerado (SHA-256):</strong><br><code>${hash}</code>`;

        // Atualiza visual do banco
        renderBanco();

        // Limpa a senha do campo (boa prática)
        document.getElementById('senha').value = '';
    });

    // Login — verifica gerando novo hash e comparando com o armazenado
    document.getElementById('btnLogin').addEventListener('click', async ()=>{
        const u = document.getElementById('loginUser').value.trim();
        const s = document.getElementById('loginPass').value;
        const msg = document.getElementById('loginMsg');
        msg.textContent = '';
        if(!u || !s){ msg.textContent = 'Preencha usuário e senha.'; return; }

        const found = db.find(x => x.usuario.toLowerCase() === u.toLowerCase());
        if(!found){ msg.textContent = 'Usuário não encontrado.'; return; }

        const tentativaHash = await sha256Hex(s);
        if(tentativaHash === found.hash){
            msg.innerHTML = '<span class="success">Login aprovado — hashes coincidem.</span>';
        } else {
            msg.innerHTML = '<span class="error">Senha incorreta — hash não confere.</span>';
        }

        // limpa campo de senha
        document.getElementById('loginPass').value = '';
    });

    // Render inicial
    renderBanco();
</script>

</body>
</html>
